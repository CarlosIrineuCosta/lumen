---
description: Start session with orchestration file
---

# Start Session

## Initialize Project Structure

```bash
# Load structure detection library from project's .claude/commands/lib
if [[ -f ".claude/commands/lib/structure-validator.sh" ]]; then
    source ".claude/commands/lib/structure-validator.sh"
elif [[ -f "$PWD/.claude/commands/lib/structure-validator.sh" ]]; then
    source "$PWD/.claude/commands/lib/structure-validator.sh"
else
    echo "âŒ Could not find structure-validator.sh"
    echo "Looking in:"
    echo "  - .claude/commands/lib/structure-validator.sh"
    echo "  - $PWD/.claude/commands/lib/structure-validator.sh"
    exit 1
fi

# Validate project context
if ! check_project_context; then
    exit 1
fi

# Initialize and validate project structure
if ! init_project_structure; then
    echo "âŒ Failed to detect project structure"
    exit 1
fi

echo "âœ… Project structure validated successfully"
print_structure
```

## Execute Session Start Script

```bash
# Look for session start script in detected scripts directory
if [[ -n "$SCRIPTS_DIR" ]] && [[ -x "$SCRIPTS_DIR/session-start.sh" ]]; then
    echo "ðŸš€ Executing session start script..."
    bash "$SCRIPTS_DIR/session-start.sh"
elif [[ -x "./scripts/session-start.sh" ]]; then
    echo "ðŸš€ Executing session start script from relative path..."
    bash "./scripts/session-start.sh"
else
    echo "âš ï¸  Session start script not found in expected locations:"
    echo "   - $SCRIPTS_DIR/session-start.sh"
    echo "   - ./scripts/session-start.sh"
    echo ""
    echo "ðŸ“‹ Creating minimal session start plan..."
    
    # Create today's orchestration file
    TODAY=$(date +%Y-%m-%d)
    START_FILE="$PROJECT_ROOT/start-here-$TODAY.md"
    
    if [[ ! -f "$START_FILE" ]]; then
        cat > "$START_FILE" << EOF
# Session Start - $TODAY

## Priority Tasks
- [ ] Review current project status
- [ ] Check development environment
- [ ] Continue with planned development work

## Orchestration Instructions  
1. Present this plan using ExitPlanMode before execution
2. Only proceed after explicit user approval
3. Use TodoWrite to track all multi-step tasks

## Session Context
**Project Root**: $PROJECT_ROOT
**Backend**: $BACKEND_DIR
**Frontend**: $FRONTEND_DIR
**Current Status**: Check docs/tasks_YYYYMMDD.md for project state

## Implementation Plan
1. Validate development environment
2. Check server status if needed
3. Proceed with development priorities

---
*Generated by structure-independent start command*
EOF
        echo "âœ… Created session plan: $START_FILE"
    fi
    
    echo "ðŸ“‹ Reading session plan..."
    cat "$START_FILE"
fi
```

## Restart Development Servers and Check External Services

```bash
# Use detected server manager script
if [[ -n "$SCRIPTS_DIR" ]] && [[ -x "$SCRIPTS_DIR/server-manager.sh" ]]; then
    echo "ðŸ”„ Restarting development servers..."
    "$SCRIPTS_DIR/server-manager.sh" restart
elif [[ -x "./scripts/server-manager.sh" ]]; then
    echo "ðŸ”„ Restarting development servers from relative path..."
    "./scripts/server-manager.sh" restart
else
    echo "âš ï¸  Server manager script not found - manual restart may be needed"
    echo "   Expected locations:"
    echo "   - $SCRIPTS_DIR/server-manager.sh"
    echo "   - ./scripts/server-manager.sh"
fi

# Check external production server status
echo ""
echo "ðŸŒ Checking external services..."
PROD_URLS=("https://lumenphotos.com")

for url in "${PROD_URLS[@]}"; do
    echo "Checking $url status..."
    if curl -s -o /dev/null -w "%{http_code}" "$url" --connect-timeout 10 | grep -q "200"; then
        echo "âœ… $url is responding (200 OK)"
    else
        echo "âŒ $url is not responding or returned non-200 status"
    fi
done
```

## AI Assistant Instructions

After the script runs and displays the orchestration plan:

1. **Present the Plan**: Use ExitPlanMode to present the orchestration plan from the file that was displayed
2. **Wait for Approval**: Only proceed after explicit user approval
3. **Setup TodoWrite**: Break down multi-step tasks using TodoWrite
4. **Begin Execution**: Start working through the plan systematically

## Critical Requirements

- Present plan using ExitPlanMode before any execution
- Wait for explicit user approval
- Use TodoWrite for all multi-step tasks
