sequenceDiagram
    participant U as User
    participant FE as Frontend
    participant AUTH as Firebase Auth
    participant API as Backend API
    participant DB as PostgreSQL
    participant FS as File Storage

    Note over U,FS: Photo Upload Flow
    
    U->>FE: Select photos to upload
    FE->>AUTH: Verify authentication
    AUTH-->>FE: JWT token valid
    
    FE->>API: POST /api/photos/upload
    Note right of API: With JWT token
    
    API->>AUTH: Verify token
    AUTH-->>API: Token valid + user info
    
    API->>FS: Store photo files
    FS-->>API: File URLs + metadata
    
    API->>DB: Insert photo records
    DB-->>API: Photo IDs created
    
    API-->>FE: Upload success + photo data
    FE-->>U: Display uploaded photos

    Note over U,FS: Photo Gallery View Flow
    
    U->>FE: Browse gallery
    FE->>API: GET /api/photos?page=1
    
    API->>AUTH: Verify token (if authenticated)
    AUTH-->>API: User context
    
    API->>DB: Query visible photos
    DB-->>API: Photo records + metadata
    
    API->>FS: Generate signed URLs
    FS-->>API: Temporary download URLs
    
    API-->>FE: Photo list + URLs
    FE-->>U: Display photo grid

    Note over U,FS: User Profile Flow
    
    U->>FE: View profile
    FE->>AUTH: Check auth status
    AUTH-->>FE: User authenticated
    
    FE->>API: GET /api/users/profile
    API->>DB: Query user data + photos
    DB-->>API: User profile + photo count
    
    API-->>FE: Profile data
    FE-->>U: Display profile page

    Note over U,FS: Search Flow
    
    U->>FE: Search for "sunset"
    FE->>API: GET /api/photos/search?q=sunset
    
    API->>DB: Full-text search
    DB-->>API: Matching photos
    
    API->>FS: Generate URLs for results
    FS-->>API: Signed URLs
    
    API-->>FE: Search results
    FE-->>U: Display search results