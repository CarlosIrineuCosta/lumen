<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Auth Debug</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .debug-info {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
            font-family: monospace;
            white-space: pre-wrap;
        }
        button {
            background: #4285f4;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 5px;
            font-size: 16px;
        }
        button:hover {
            background: #3367d6;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success { background: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .error { background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
        .warning { background: #fff3cd; border: 1px solid #ffeaa7; color: #856404; }
        .info { background: #d1ecf1; border: 1px solid #b8daff; color: #0c5460; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Firebase Authentication Debug</h1>
        <p><strong>Current URL:</strong> <span id="currentUrl"></span></p>
        <p><strong>Testing Domain Authorization:</strong> 100.106.201.33:8001</p>
        
        <div class="debug-info" id="debugInfo">Initializing Firebase...</div>
        
        <button id="testPopup">Test Google Popup</button>
        <button id="testRedirect">Test Google Redirect</button>
        <button id="checkConfig">Check Firebase Config</button>
        <button id="signOut">Sign Out</button>
        
        <div id="status"></div>
        <div id="userInfo"></div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    
    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCt8ERvmCTaV5obZHBTqOAOSCMTq-v16nE",
            authDomain: "lumen-photo-app-20250731.firebaseapp.com",
            projectId: "lumen-photo-app-20250731",
            storageBucket: "lumen-photo-app-20250731.firebasestorage.app",
            messagingSenderId: "316971929294",
            appId: "1:316971929294:web:2163c5676bdeabe30e8a9f",
            measurementId: "G-9KNBNQWSDG"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        
        // Debug helpers
        const debugInfo = document.getElementById('debugInfo');
        const status = document.getElementById('status');
        const userInfo = document.getElementById('userInfo');
        
        document.getElementById('currentUrl').textContent = window.location.href;
        
        function log(message, type = 'info') {
            console.log(`[${type.toUpperCase()}] ${message}`);
            debugInfo.textContent += `\n[${new Date().toLocaleTimeString()}] ${message}`;
            debugInfo.scrollTop = debugInfo.scrollHeight;
        }
        
        function showStatus(message, type) {
            status.innerHTML = `<div class="status ${type}">${message}</div>`;
        }
        
        // Firebase Auth State Listener
        firebase.auth().onAuthStateChanged((user) => {
            if (user) {
                log(`User signed in: ${user.email} (${user.uid})`, 'success');
                userInfo.innerHTML = `
                    <div class="status success">
                        <strong>Authenticated User:</strong><br>
                        Email: ${user.email}<br>
                        UID: ${user.uid}<br>
                        Verified: ${user.emailVerified}
                    </div>
                `;
                showStatus('Successfully authenticated!', 'success');
            } else {
                log('User signed out', 'info');
                userInfo.innerHTML = '';
                showStatus('Not authenticated', 'warning');
            }
        });
        
        // Test Google Popup
        document.getElementById('testPopup').onclick = async () => {
            log('Testing Google Sign-In Popup...', 'info');
            
            try {
                const provider = new firebase.auth.GoogleAuthProvider();
                provider.addScope('email');
                provider.addScope('profile');
                
                log('Creating popup...', 'info');
                const result = await firebase.auth().signInWithPopup(provider);
                log(`Popup success: ${result.user.email}`, 'success');
                
            } catch (error) {
                log(`Popup error: ${error.code} - ${error.message}`, 'error');
                
                if (error.code === 'auth/popup-closed-by-user') {
                    showStatus('Popup was closed. Please try again.', 'warning');
                } else if (error.code === 'auth/popup-blocked') {
                    showStatus('Popup was blocked. Please allow popups for this site.', 'error');
                } else if (error.code === 'auth/unauthorized-domain') {
                    showStatus('Domain not authorized in Firebase Console. Need to add 100.106.201.33 to authorized domains.', 'error');
                } else {
                    showStatus(`Authentication error: ${error.message}`, 'error');
                }
            }
        };
        
        // Test Google Redirect
        document.getElementById('testRedirect').onclick = async () => {
            log('Testing Google Sign-In Redirect...', 'info');
            
            try {
                const provider = new firebase.auth.GoogleAuthProvider();
                provider.addScope('email');
                provider.addScope('profile');
                
                await firebase.auth().signInWithRedirect(provider);
                log('Redirect initiated...', 'info');
                
            } catch (error) {
                log(`Redirect error: ${error.code} - ${error.message}`, 'error');
                showStatus(`Redirect error: ${error.message}`, 'error');
            }
        };
        
        // Check Firebase Config
        document.getElementById('checkConfig').onclick = () => {
            log('Firebase Configuration Check:', 'info');
            log(`Project ID: ${firebaseConfig.projectId}`, 'info');
            log(`Auth Domain: ${firebaseConfig.authDomain}`, 'info');
            log(`Current Domain: ${window.location.hostname}:${window.location.port}`, 'info');
            log(`Current Origin: ${window.location.origin}`, 'info');
            
            const auth = firebase.auth();
            log(`Auth instance: ${auth ? 'OK' : 'FAILED'}`, auth ? 'success' : 'error');
            
            showStatus('Configuration check completed. See debug log.', 'info');
        };
        
        // Sign Out
        document.getElementById('signOut').onclick = async () => {
            try {
                await firebase.auth().signOut();
                log('Signed out successfully', 'success');
                showStatus('Signed out successfully', 'success');
            } catch (error) {
                log(`Sign out error: ${error.message}`, 'error');
                showStatus(`Sign out error: ${error.message}`, 'error');
            }
        };
        
        // Handle redirect result
        firebase.auth().getRedirectResult().then((result) => {
            if (result.user) {
                log(`Redirect success: ${result.user.email}`, 'success');
            }
        }).catch((error) => {
            log(`Redirect result error: ${error.code} - ${error.message}`, 'error');
        });
        
        // Initial setup
        log('Firebase Auth Debug loaded', 'success');
        log(`Testing on: ${window.location.origin}`, 'info');
    </script>
</body>
</html>